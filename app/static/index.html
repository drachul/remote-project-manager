<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Remote Project Manager</title>
    <link rel="icon" type="image/png" href="/static/rpm-icon.png" />
    <link rel="stylesheet" href="/static/vendor/xterm/xterm.css" />
    <link rel="stylesheet" href="/static/vendor/codemirror/codemirror.min.css" />
    <link rel="stylesheet" href="/static/vendor/codemirror/theme/material-darker.min.css" />
    <link rel="stylesheet" href="/static/vendor/codemirror/addon/lint/lint.min.css" />
    <link rel="stylesheet" href="/static/vendor/codemirror/addon/merge/merge.min.css" />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div class="page">
      <header class="top">
        <div class="brand">
          <a
            class="brand-mark"
            href="https://github.com/drachul/remote-project-manager"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="Remote Project Manager GitHub"
          >
            <img src="/static/rpm-logo.png" alt="Remote Project Manager logo" />
          </a>
          <div>
            <h1>Remote Project Manager</h1>
            <p>Operate remote Docker Compose projects with a single control plane.</p>
          </div>
        </div>
        <div class="controls">
          <div class="user-row">
            <button
              class="user-badge"
              id="currentUserBadge"
              type="button"
              aria-haspopup="true"
              aria-expanded="false"
            >
              <span class="user-badge-name" id="currentUserName">--</span>
            </button>
            <button
              class="btn subtle"
              id="openConfig"
              aria-label="Configuration"
              title="Configuration"
            >
              <span class="material-symbols-outlined action-icon">settings</span>
            </button>
            <div class="user-menu hidden" id="userMenu">
              <div class="user-menu-title">Account</div>
              <label class="control">
                Current password
                <input type="password" id="userCurrentPassword" autocomplete="current-password" />
              </label>
              <label class="control">
                New password
                <input type="password" id="userNewPassword" autocomplete="new-password" />
              </label>
              <div class="user-menu-actions">
                <button class="btn subtle" id="userChangePassword" type="button">Change password</button>
                <button class="btn ghost" id="userLogout" type="button">Log out</button>
              </div>
              <div class="user-menu-status" id="userMenuStatus"></div>
            </div>
          </div>
          
        </div>
      </header>

      <section class="panel-grid">
        <div class="panel host-panel">
          <div class="panel-head">
            <div>
              <h2>Hosts</h2>
              <div class="panel-sub">Manage hosts and quick actions.</div>
            </div>
          </div>
          <ul class="list full-only" id="hostList">
            <li class="list-row empty">Loading hosts...</li>
          </ul>
          <table class="host-table compact-only">
            <thead>
              <tr>
                <th>Host</th>
                <th class="col-actions">Actions</th>
              </tr>
            </thead>
            <tbody id="hostTableBody">
              <tr class="list-row empty">
                <td colspan="2">Loading hosts...</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="panel projects-panel">
          <div class="panel-head">
            <div>
              <h2>Projects</h2>
              <div class="panel-sub" id="projectCount">0 projects</div>
            </div>
            <div class="panel-actions">
              <button class="btn subtle" id="openBackupSchedule" aria-label="Backup schedule" title="Backup schedule">
                <span class="material-symbols-outlined action-icon">event</span>
              </button>
              <button class="btn subtle" id="openRestoreModal" aria-label="Restore" title="Restore">
                <span class="material-symbols-outlined action-icon">cloud_download</span>
              </button>
              <button class="btn subtle" id="openCreateProject" aria-label="Create project" title="Create project">
                <span class="material-symbols-outlined action-icon">note_add</span>
              </button>
            </div>
          </div>
          <div class="project-toolbar">
            <label class="control project-search">
              Project
              <input
                type="text"
                id="projectFilterName"
                placeholder="Search project names"
                autocomplete="off"
              />
            </label>
            <button class="btn subtle filter-clear" id="clearProjectFilters" type="button" aria-label="Clear filters" title="Clear filters">
              <span class="material-symbols-outlined action-icon">filter_alt_off</span>
              <span class="filter-count hidden" id="projectFilterCount">0</span>
            </button>
          </div>
          
          <div class="bulk-actions-wrap hidden" id="bulkActionsWrap">
            <div class="bulk-actions-label">Bulk Actions</div>
            <div class="bulk-actions" id="bulkActions">
              <button class="btn ghost bulk-action" data-bulk-action="start" aria-label="Start" title="Start">
                <span class="material-symbols-outlined action-icon">play_arrow</span>
              </button>
              <button class="btn ghost bulk-action" data-bulk-action="stop" aria-label="Stop" title="Stop">
                <span class="material-symbols-outlined action-icon">stop</span>
              </button>
              <button class="btn ghost bulk-action" data-bulk-action="restart" aria-label="Restart" title="Restart">
                <span class="material-symbols-outlined action-icon">restart_alt</span>
              </button>
              <button class="btn ghost bulk-action" data-bulk-action="update" aria-label="Update" title="Update">
                <span class="material-symbols-outlined action-icon">system_update_alt</span>
              </button>
              <button class="btn ghost bulk-action" data-bulk-action="backup" aria-label="Backup" title="Backup">
                <span class="material-symbols-outlined action-icon">backup</span>
              </button>
            </div>
          </div>
          <div class="progress hidden" id="bulkProgress">
            <div class="progress-text" id="bulkProgressText">Updating 0/0</div>
            <div class="progress-track">
              <div class="progress-bar" id="bulkProgressBar"></div>
            </div>
          </div>
          <table class="project-table">
            <thead>
              <tr>
                <th class="col-select">
                  <label class="table-select-all" title="Select all / clear">
                    <input type="checkbox" id="projectSelectToggle" aria-label="Select all projects" />
                  </label>
                </th>
                <th class="col-host">
                  <div class="header-controls">
                    <button class="sort-header" data-sort="host" type="button">
                      <span>Host</span>
                      <span class="sort-indicator"></span>
                    </button>
                  </div>
                </th>
                <th class="col-project">
                  <div class="header-controls">
                    <button class="sort-header" data-sort="name" type="button">
                      <span>Project</span>
                      <span class="sort-indicator"></span>
                    </button>
                    <button class="filter-toggle" data-filter="hosts" type="button" aria-label="Filter hosts" title="Filter hosts">
                      <span class="material-symbols-outlined action-icon">filter_list</span>
                    </button>
                    <button class="btn subtle compact-only compact-clear" id="clearProjectFiltersCompact" aria-label="Clear filters" title="Clear filters">
                      <span class="material-symbols-outlined action-icon">filter_alt_off</span>
                    </button>
                    <div class="filter-menu hidden" data-filter-menu="hosts">
                      <label class="control">
                        Hosts
                        <select id="headerFilterHosts" multiple size="5"></select>
                      </label>
                      <button class="btn ghost filter-clear" type="button" data-filter-clear="hosts">Clear</button>
                    </div>
                  </div>
                </th>
                <th class="col-status">
                  <div class="header-controls">
                    <button class="sort-header" data-sort="status" type="button">
                      <span>Status</span>
                      <span class="sort-indicator"></span>
                    </button>
                    <button class="filter-toggle" data-filter="status" type="button" aria-label="Filter status" title="Filter status">
                      <span class="material-symbols-outlined action-icon">filter_list</span>
                    </button>
                    <div class="filter-menu hidden" data-filter-menu="status">
                      <label class="control">
                        Status
                        <select id="headerFilterStatus">
                          <option value="all">All</option>
                          <option value="up">Up</option>
                          <option value="degraded">Degraded</option>
                          <option value="down">Down</option>
                          <option value="unknown">Unknown</option>
                          <option value="sleeping">Sleeping</option>
                        </select>
                      </label>
                    </div>
                  </div>
                </th>
                <th class="col-updates">
                  <div class="header-controls">
                    <button class="sort-header" data-sort="updates" type="button">
                      <span>Update</span>
                      <span class="sort-indicator"></span>
                    </button>
                    <button class="filter-toggle" data-filter="updates" type="button" aria-label="Filter updates" title="Filter updates">
                      <span class="material-symbols-outlined action-icon">filter_list</span>
                    </button>
                    <div class="filter-menu hidden" data-filter-menu="updates">
                      <label class="control">
                        Updates
                        <select id="headerFilterUpdates">
                          <option value="all">All</option>
                          <option value="yes">Available</option>
                          <option value="no">None</option>
                        </select>
                      </label>
                    </div>
                  </div>
                </th>
                <th class="col-actions">Actions</th>
              </tr>
            </thead>
            <tbody id="projectList">
              <tr class="list-row empty">
                <td colspan="6">Select a host to see projects.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </div>

    <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>

    <div class="modal hidden" id="authModal">
      <div class="modal-backdrop"></div>
      <div class="modal-card auth-modal-card">
        <header class="modal-header">
          <div>
            <div class="modal-title">Sign in</div>
            <div class="modal-subtitle">Enter your credentials to continue.</div>
          </div>
        </header>
        <div class="modal-body auth-body">
          <label class="control">
            Username
            <input type="text" id="authUsername" autocomplete="username" />
          </label>
          <label class="control">
            Password
            <input type="password" id="authPassword" autocomplete="current-password" />
          </label>
          <div class="schedule-actions">
            <button class="btn primary" id="authSubmit">Sign in</button>
          </div>
          <div class="config-status" id="authStatus"></div>
        </div>
      </div>
    </div>

    <template id="hostRowTemplate">
      <li class="list-row">
        <div class="host-info">
          <span class="row-title host-name"></span>
          <span class="row-subtitle host-meta"></span>
        </div>
        <div class="row-actions host-actions">
          <button class="btn subtle host-action action-ready sleep-host" aria-label="Sleep host" title="Sleep host (stop running projects and mark sleeping)">
            <span class="material-symbols-outlined action-icon">bedtime</span>
          </button>
          <button class="btn subtle host-action action-ready wake-host" aria-label="Wake host" title="Wake host (start sleeping projects)">
            <span class="material-symbols-outlined action-icon">light_mode</span>
          </button>
          <button class="btn subtle host-action action-ready refresh-host" aria-label="Refresh project statuses" title="Refresh project statuses">
            <span class="material-symbols-outlined action-icon">sync_desktop</span>
          </button>
          <button class="btn subtle host-action action-ready scan-host" aria-label="Scan projects" title="Scan projects on host">
            <span class="material-symbols-outlined action-icon">scan</span>
          </button>
        </div>
      </li>
    </template>

    <template id="hostTableRowTemplate">
      <tr class="list-row host-row">
        <td class="host-cell host-main">
          <div class="host-info">
            <span class="row-title host-name"></span>
            <span class="row-subtitle host-meta"></span>
          </div>
        </td>
        <td class="host-cell host-actions-cell">
          <div class="row-actions host-actions">
            <button class="btn subtle host-action action-ready sleep-host" aria-label="Sleep host" title="Sleep host (stop running projects and mark sleeping)">
              <span class="material-symbols-outlined action-icon">bedtime</span>
            </button>
            <button class="btn subtle host-action action-ready wake-host" aria-label="Wake host" title="Wake host (start sleeping projects)">
              <span class="material-symbols-outlined action-icon">light_mode</span>
            </button>
            <button class="btn subtle host-action action-ready refresh-host" aria-label="Refresh project statuses" title="Refresh project statuses">
              <span class="material-symbols-outlined action-icon">sync_desktop</span>
            </button>
            <button class="btn subtle host-action action-ready scan-host" aria-label="Scan projects" title="Scan projects on host">
              <span class="material-symbols-outlined action-icon">scan</span>
            </button>
          </div>
        </td>
      </tr>
    </template>

    <template id="projectRowTemplate">
      <tr class="list-row project-row">
        <td class="project-cell project-select">
          <input class="project-checkbox" type="checkbox" aria-label="Select project" />
        </td>
        <td class="project-cell project-host">
          <span class="project-host-id"></span>
        </td>
        <td class="project-cell project-main">
          <div class="row-title project-title">
            <span class="project-name"></span>
            <button class="btn ghost project-details" aria-label="Project details" title="Project details">
              <span class="material-symbols-outlined action-icon">info</span>
            </button>
          </div>
          <div class="project-extra">
            <div class="services-summary">
              <span class="services-text"></span>
              <span class="material-symbols-outlined services-caret">expand_more</span>
            </div>
            <div class="errors"></div>
            <div class="services-panel hidden">
              <ul class="services-list"></ul>
            </div>
          </div>
        </td>
        <td class="project-cell project-status">
          <div class="status-badges">
            <span class="status-icon-wrap">
              <span class="material-symbols-outlined status-icon" title="Status"></span>
              <span class="status-count health-count hidden" aria-hidden="true"></span>
              <span class="status-count down-count hidden" aria-hidden="true"></span>
            </span>
            <span class="material-symbols-outlined sleep-icon" title="Sleeping"></span>
          </div>
        </td>
        <td class="project-cell project-updates">
          <span class="updates-link hidden">
            <span class="material-symbols-outlined updates-icon" title="Updates"></span>
            <span class="updates-count hidden" aria-hidden="true"></span>
          </span>
        </td>
        <td class="project-cell project-actions">
          <div class="action-menu">
            <button class="btn ghost action-menu-toggle" aria-label="Actions" title="Actions">
              <span class="material-symbols-outlined action-icon">menu</span>
            </button>
            <div class="action-menu-panel hidden">
              <div class="row-actions">
                <button class="btn ghost project-action" data-action="start" aria-label="Start project" title="Start project">
                  <span class="material-symbols-outlined action-icon action-label">play_arrow</span>
                </button>
                <button class="btn ghost project-action" data-action="stop" aria-label="Stop project" title="Stop project">
                  <span class="material-symbols-outlined action-icon action-label">stop</span>
                </button>
                <button class="btn ghost project-action" data-action="restart" aria-label="Restart project" title="Restart project">
                  <span class="material-symbols-outlined action-icon action-label">restart_alt</span>
                </button>
                <button class="btn ghost project-action" data-action="update" aria-label="Update project" title="Update project images">
                  <span class="material-symbols-outlined action-icon action-label">system_update_alt</span>
                </button>
                <button class="btn ghost project-action" data-action="backup" aria-label="Backup project" title="Backup project">
                  <span class="material-symbols-outlined action-icon action-label">backup</span>
                </button>
                <button class="btn ghost project-action" data-action="refresh" aria-label="Refresh project status" title="Refresh project status">
                  <span class="material-symbols-outlined action-icon action-label">sync_desktop</span>
                </button>
                <button class="btn ghost logs" aria-label="Logs" title="View logs">
                  <span class="material-symbols-outlined action-icon">article</span>
                </button>
                <button class="btn ghost compose" aria-label="Compose file" title="Edit compose file">
                  <span class="material-symbols-outlined action-icon">edit_document</span>
                </button>
                <button class="btn ghost compose-command" aria-label="Compose command" title="Run compose command">
                  <span class="material-symbols-outlined action-icon">terminal</span>
                </button>
                <button class="btn ghost project-delete" title="Delete project" aria-label="Delete project">
                  <span class="material-symbols-outlined action-icon delete-icon">delete</span>
                </button>
              </div>
            </div>
          </div>
        </td>
      </tr>
    </template>
    <template id="hostConfigTemplate">
      <div class="config-entry host-entry">
        <div class="config-entry-head">
          <button class="config-collapse" type="button" aria-label="Toggle host details">
            <span class="material-symbols-outlined">expand_more</span>
          </button>
          <div class="config-entry-title host-title"></div>
        </div>
        <div class="host-body">
        <div class="config-grid">
          <label class="control">
            ID
            <input type="text" class="host-id" placeholder="primary" />
          </label>
          <label class="control">
            Project root
            <input type="text" class="host-root" placeholder="/opt/compose" />
          </label>
          <label class="control">
            SSH address
            <input type="text" class="host-address" placeholder="example.com" />
          </label>
          <label class="control">
            SSH username
            <input type="text" class="host-user" placeholder="deploy" />
          </label>
          <label class="control">
            SSH port
            <input type="number" min="1" max="65535" class="host-port" value="22" />
          </label>
          <label class="control span-2">
            SSH private key
            <textarea class="host-key" rows="5" placeholder="-----BEGIN OPENSSH PRIVATE KEY-----"></textarea>
          </label>
        </div>
        <div class="config-entry-footer">
          <div class="config-entry-actions align-right">
            <button class="btn subtle config-save">Save</button>
            <button class="btn ghost danger-text config-delete">Delete</button>
          </div>
        </div>
        </div>
      </div>
    </template>
    <template id="backupConfigTemplate">
      <div class="config-entry backup-entry">
        <div class="config-entry-head">
          <button class="config-collapse" type="button" aria-label="Toggle backup details">
            <span class="material-symbols-outlined">expand_more</span>
          </button>
          <div class="config-entry-title backup-title"></div>
          <div class="config-entry-actions align-right">
            <label class="toggle backup-toggle">
              <input type="checkbox" class="backup-enabled" />
              <span>Enabled</span>
            </label>
          </div>
        </div>
        <div class="config-grid">
          <label class="control">
            ID
            <input type="text" class="backup-id" placeholder="default" />
          </label>
          <label class="control">
            Address
            <input type="text" class="backup-address" placeholder="backup.example.com" />
          </label>
          <label class="control">
            Username
            <input type="text" class="backup-username" placeholder="backup" />
          </label>
          <label class="control">
            Password
            <input type="password" class="backup-password" placeholder="••••••" />
          </label>
          <label class="control">
            Protocol
            <select class="backup-protocol">
              <option value="ssh">ssh</option>
              <option value="rsync">rsync</option>
            </select>
          </label>
          <label class="control">
            Port
            <input type="number" min="1" max="65535" class="backup-port" value="22" />
          </label>
          <label class="control span-2">
            Base path
            <input type="text" class="backup-base-path" placeholder="/backups/compose" />
          </label>
        </div>
        <div class="config-entry-footer">
          <div class="config-entry-actions align-right">
            <button class="btn subtle config-save">Save</button>
            <button class="btn ghost danger-text config-delete">Delete</button>
          </div>
        </div>
      </div>
    </template>

    <template id="userConfigTemplate">
      <div class="config-entry">
        <div class="config-entry-head">
          <div class="config-entry-title"></div>
        </div>
        <div class="config-grid">
          <label class="control">
            Username
            <input type="text" class="user-name" placeholder="admin" />
          </label>
          <label class="control">
            Role
            <select class="user-role">
              <option value="admin">Admin</option>
              <option value="power">Power</option>
              <option value="normal">Normal</option>
            </select>
          </label>
          <label class="control">
            Password
            <input type="password" class="user-password" placeholder="Set a new password" />
          </label>
        </div>
        <div class="config-entry-footer">
          <div class="config-entry-sub user-last-login">Last login: never</div>
          <div class="config-entry-actions align-right">
            <button class="btn subtle config-save">Save</button>
            <button class="btn ghost danger-text config-delete">Delete</button>
          </div>
        </div>
      </div>
    </template>

    <template id="tokenConfigTemplate">
      <div class="config-entry token-entry">
        <div class="config-entry-head">
          <div class="config-entry-title token-title"></div>
          <div class="config-entry-actions">
            <button class="btn ghost danger-text config-delete">Delete</button>
          </div>
        </div>
      </div>
    </template>


    <div class="modal hidden" id="composeModal">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <header class="modal-header">
          <div>
            <div class="modal-title">Compose editor</div>
            <div class="modal-subtitle" id="composeTarget"></div>
          </div>
          <button class="modal-close" id="closeComposeModal" aria-label="Close">
            <span class="material-symbols-outlined">close</span>
          </button>
        </header>
        <div class="compose-panel">
          <div class="compose-header">
            <div class="compose-path" id="composePath"></div>
          </div>
          <div class="compose-search hidden" id="composeSearchBar">
            <label class="control">
              Find
              <input type="text" id="composeSearchInput" autocomplete="off" />
            </label>
            <label class="control">
              Replace
              <input type="text" id="composeReplaceInput" autocomplete="off" />
            </label>
            <div class="compose-search-actions">
              <button class="btn subtle" id="composeFindNext" type="button">Find</button>
              <button class="btn subtle" id="composeReplace" type="button">Replace</button>
              <button class="btn subtle" id="composeReplaceAll" type="button">Replace all</button>
              <button class="btn ghost" id="composeSearchClose" type="button" aria-label="Close search" title="Close">Close</button>
            </div>
          </div>
          <div class="compose-main">
            <div class="compose-editor-wrap">
              <textarea class="compose-editor" id="composeEditor" spellcheck="false"></textarea>
            </div>
            <div class="diff-panel hidden" id="diffPanel">
              <div class="diff-header">Diff preview</div>
              <div class="diff-view" id="diffView"></div>
            </div>
          </div>
          <div class="compose-status" id="composeStatus"></div>
          <pre class="compose-lint hidden" id="composeLint"></pre>
          <div class="compose-actions">
            <button class="btn subtle" id="previewCompose">Review</button>
            <button class="btn subtle hidden" id="confirmCompose">Save</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="commandModal">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <header class="modal-header">
          <div>
            <div class="modal-title">Compose command</div>
            <div class="modal-subtitle" id="commandTarget"></div>
          </div>
          <button class="modal-close" id="closeCommandModal" aria-label="Close">
            <span class="material-symbols-outlined">close</span>
          </button>
        </header>
        <div class="modal-body command-body">
          <label class="control">
            Command
            <input id="commandInput" type="text" placeholder="ps -a" />
          </label>
          <div class="command-actions">
            <button class="btn subtle" id="runCommand">Run</button>
          </div>
          <div class="command-status" id="commandStatus"></div>
          <pre class="command-output" id="commandOutput"></pre>
        </div>
      </div>
    </div>


    <div class="modal hidden" id="logsModal">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <header class="modal-header">
          <div>
            <div class="modal-title">Logs</div>
            <div class="modal-subtitle" id="logsTarget"></div>
          </div>
          <button class="modal-close" id="closeLogsModal" aria-label="Close">
            <span class="material-symbols-outlined">close</span>
          </button>
        </header>
        <div class="logs-controls">
          <label class="control">
            Service
            <input id="logsService" type="text" placeholder="optional" />
          </label>
          <label class="control">
            Tail
            <input id="logsTail" type="number" min="1" max="5000" value="200" />
          </label>
          <label class="toggle">
            <input id="logsShowStdout" type="checkbox" checked />
            <span>Stdout</span>
          </label>
          <label class="toggle">
            <input id="logsShowStderr" type="checkbox" checked />
            <span>Stderr</span>
          </label>
          <button class="btn subtle" id="refreshLogs">Refresh</button>
          <button class="btn subtle" id="toggleFollow">Follow</button>
        </div>
        <div class="logs-panel">
          <pre class="logs-content" id="logsContent"></pre>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="shellModal">
      <div class="modal-backdrop"></div>
      <div class="modal-card shell-modal-card">
        <header class="modal-header">
          <div>
            <div class="modal-title">Service shell</div>
            <div class="modal-subtitle" id="shellTarget"></div>
          </div>
          <button class="modal-close" id="closeShellModal" aria-label="Close">
            <span class="material-symbols-outlined">close</span>
          </button>
        </header>
        <div class="modal-body shell-body">
          <div class="shell-status" id="shellStatus"></div>
          <div class="shell-terminal" id="shellTerminal"></div>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="projectDetailsModal">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <header class="modal-header">
          <div>
            <div class="modal-title">Project details</div>
            <div class="modal-subtitle" id="projectDetailsTitle"></div>
          </div>
          <button class="modal-close" id="closeProjectDetailsModal" aria-label="Close">
            <span class="material-symbols-outlined">close</span>
          </button>
        </header>
        <div class="modal-body">
          <div class="details-grid">
            <div class="detail-item">
              <div class="detail-label">Host</div>
              <div class="detail-value" id="projectDetailsHost"></div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Project path</div>
              <div class="detail-value" id="projectDetailsPath"></div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Last backup</div>
              <div class="detail-value" id="projectDetailsBackup"></div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Backup status</div>
              <div class="detail-value" id="projectDetailsBackupSuccess"></div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Status updated</div>
              <div class="detail-value" id="projectDetailsStatus"></div>
            </div>
          </div>
          <div class="details-section">
            <div class="details-section-title">Ports</div>
            <div class="stats-table-wrap">
              <table class="stats-table">
                <thead>
                  <tr>
                    <th>Service</th>
                    <th>Port/Proto</th>
                    <th>Host IP</th>
                    <th>Host Port</th>
                  </tr>
                </thead>
                <tbody id="projectDetailsPortsBody">
                  <tr class="empty">
                    <td colspan="4">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="details-section">
            <div class="details-section-title">Stats</div>
            <div class="stats-table-wrap">
              <table class="stats-table">
                <thead>
                  <tr>
                    <th>Service</th>
                    <th>CPU</th>
                    <th>Mem</th>
                    <th>Net I/O</th>
                    <th>Block I/O</th>
                    <th>PIDs</th>
                    <th>Uptime</th>
                    <th>Restarts</th>
                  </tr>
                </thead>
                <tbody id="projectDetailsStatsBody">
                  <tr class="empty">
                    <td colspan="8">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="backupScheduleModal">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <header class="modal-header">
          <div>
            <div class="modal-title">Backup schedule</div>
            <div class="modal-subtitle">Configure when scheduled backups run (local time).</div>
          </div>
          <button class="modal-close" id="closeBackupScheduleModal" aria-label="Close">
            <span class="material-symbols-outlined">close</span>
          </button>
        </header>
        <div class="modal-body">
          <div class="schedule-body">
            <div class="schedule-summary">
              <table class="schedule-summary-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Last run</th>
                    <th>Last status</th>
                    <th>Next run</th>
                    <th class="center">Enabled</th>
                    <th class="center">Override</th>
                  </tr>
                </thead>
                <tbody id="scheduleSummaryBody">
                  <tr class="empty">
                    <td colspan="6">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="schedule-config" id="scheduleConfig">
              <div class="schedule-field schedule-scope hidden">
                <label for="scheduleScope">Schedule for</label>
                <select id="scheduleScope"></select>
              </div>
              <div class="field-hint schedule-scope-hint" id="scheduleScopeHint"></div>
              <div class="schedule-grid">
                <div class="schedule-field">
                  <label for="scheduleTime">Time (local)</label>
                  <input id="scheduleTime" type="time" step="60" />
                </div>

                <div class="schedule-field">
                  <span class="field-label">Days of week</span>
                  <div class="schedule-days" id="scheduleDaysOfWeek">
                    <label class="schedule-day">
                      <input type="checkbox" value="1" />
                      <span>Mon</span>
                    </label>
                    <label class="schedule-day">
                      <input type="checkbox" value="2" />
                      <span>Tue</span>
                    </label>
                    <label class="schedule-day">
                      <input type="checkbox" value="3" />
                      <span>Wed</span>
                    </label>
                    <label class="schedule-day">
                      <input type="checkbox" value="4" />
                      <span>Thu</span>
                    </label>
                    <label class="schedule-day">
                      <input type="checkbox" value="5" />
                      <span>Fri</span>
                    </label>
                    <label class="schedule-day">
                      <input type="checkbox" value="6" />
                      <span>Sat</span>
                    </label>
                    <label class="schedule-day">
                      <input type="checkbox" value="0" />
                      <span>Sun</span>
                    </label>
                  </div>
                </div>

                <div class="schedule-field">
                  <label for="scheduleDaysOfMonth">Days of month</label>
                  <select id="scheduleDaysOfMonth" multiple size="6"></select>
                  <div class="field-hint">Leave empty for any day.</div>
                </div>

                <div class="schedule-field">
                  <label for="scheduleMonths">Months</label>
                  <select id="scheduleMonths" multiple size="6"></select>
                  <div class="field-hint">Leave empty for any month.</div>
                </div>
              </div>

              <div class="schedule-field">
                <label for="cronExpression">Cron expression</label>
                <input id="cronExpression" type="text" />
                <label class="toggle schedule-custom">
                  <input type="checkbox" id="customCron" />
                  <span>Use custom cron</span>
                </label>
              </div>

              <div class="schedule-info">
                <span>Last run: <strong id="scheduleLast">never</strong></span>
                <span>Next run: <strong id="scheduleNext">never</strong></span>
              </div>

              <div class="schedule-actions align-right">
                <button class="btn primary accent-blue" id="saveSchedule">Save</button>
              </div>

              <div class="schedule-status" id="scheduleStatus"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="restoreModal">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <header class="modal-header">
          <div>
            <div class="modal-title">Restore from backup</div>
            <div class="modal-subtitle">Select a backup target and project to restore.</div>
          </div>
          <button class="modal-close" id="closeRestoreModal" aria-label="Close">
            <span class="material-symbols-outlined">close</span>
          </button>
        </header>
        <div class="modal-body">
          <div class="config-grid">
            <label class="control">
              Backup target
              <select id="restoreBackupTarget"></select>
            </label>
            <label class="control">
              Restore host
              <select id="restoreHost"></select>
            </label>
          </div>
          <label class="control">
            Project to restore
            <select id="restoreProject" size="8" multiple></select>
          </label>
          <div class="field-hint">Select one or more projects to restore.</div>
          <div class="config-status" id="restoreStatus"></div>
          <div class="schedule-actions align-right">
            <button class="btn primary accent-blue" id="runRestore">Restore</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="configModal">
      <div class="modal-backdrop"></div>
      <div class="modal-card config-modal-card">
        <header class="modal-header">
          <div>
            <div class="modal-title">Configuration</div>
          </div>
          <button class="modal-close" id="closeConfigModal" aria-label="Close">
            <span class="material-symbols-outlined">close</span>
          </button>
        </header>
        <div class="modal-body config-body">
          <div class="config-tabs">
            <button class="config-tab active" data-tab="hosts">Hosts</button>
            <button class="config-tab" data-tab="users">Users</button>
            <button class="config-tab" data-tab="tokens">Tokens</button>
            <button class="config-tab" data-tab="backups">Backups</button>
            <button class="config-tab" data-tab="events">Events</button>
            <button class="config-tab" data-tab="misc">Misc</button>
          </div>
          <div class="config-tab-panel active" data-tab-panel="hosts">
            <section class="config-section">
              <div class="config-section-head">
                <div>
                  <div class="config-section-title">Hosts</div>
                  <div class="config-section-sub">Configure each SSH host the service will manage.</div>
                </div>
                <button class="btn subtle align-right" id="addHostConfig">Add</button>
              </div>
              <div class="config-list" id="hostConfigList"></div>
            </section>
          </div>
          <div class="config-tab-panel" data-tab-panel="users">
            <section class="config-section">
              <div class="config-section-head">
                <div>
                  <div class="config-section-title">Users</div>
                  <div class="config-section-sub">Manage local accounts for sign-in.</div>
                </div>
                <button class="btn subtle align-right" id="addUserConfig">Add</button>
              </div>
              <div class="config-list" id="userConfigList"></div>
            </section>
          </div>
          <div class="config-tab-panel" data-tab-panel="tokens">
            <section class="config-section">
              <div class="config-section-head">
                <div>
                  <div class="config-section-title">Tokens</div>
                  <div class="config-section-sub">Create long-lived access tokens.</div>
                </div>
                <button class="btn subtle align-right" id="addTokenConfig">Add</button>
              </div>
              <div class="config-list" id="tokenConfigList"></div>
            </section>
          </div>
          <div class="config-tab-panel" data-tab-panel="backups">
            <section class="config-section">
              <div class="config-section-head">
                <div>
                  <div class="config-section-title">Backups</div>
                  <div class="config-section-sub">Configure backup destinations for rsync jobs. The first entry is used.</div>
                </div>
                <button class="btn subtle align-right" id="addBackupConfig">Add</button>
              </div>
              <div class="config-list" id="backupConfigList"></div>
            </section>
          </div>
          <div class="config-tab-panel" data-tab-panel="events">
            <section class="config-section">
              <div class="config-section-head">
                <div>
                  <div class="config-section-title">Background events</div>
                  <div class="config-section-sub">Status of timed background tasks.</div>
                </div>
              </div>
              <div class="event-status-body">
                <div class="event-status-header">
                  <div class="event-status-updated" id="eventStatusUpdated">Updated: --</div>
                  <div class="event-status-actions">
                    <button class="btn ghost event-auto-toggle" id="toggleEventAuto">Auto refresh: On</button>
                    <button class="btn subtle" id="refreshEventStatus">Refresh</button>
                  </div>
                </div>
                <div class="event-status-list" id="eventStatusList">
                  <div class="empty">Loading...</div>
                </div>
              </div>
            </section>
          </div>
          <div class="config-tab-panel" data-tab-panel="misc">
            <section class="config-section">
              <div class="config-section-head">
                <div>
                  <div class="config-section-title">Misc</div>
                  <div class="config-section-sub">Authentication settings.</div>
                </div>
              </div>
              <div class="config-grid config-grid-vertical">
                <label class="control">
                  Token expiry (seconds)
                  <input type="number" min="30" id="tokenExpirySeconds" />
                </label>
              </div>
              <div class="schedule-actions align-right">
                <button class="btn subtle" id="saveTokenExpiry">Save</button>
              </div>
            </section>
          </div>
          <div class="config-status" id="configStatus"></div>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="tokenCreateModal">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <header class="modal-header">
          <div>
            <div class="modal-title">Create token</div>
            <div class="modal-subtitle">Copy this token now. It will not be shown again.</div>
          </div>
          <button class="modal-close" id="closeTokenCreateModal" aria-label="Close">
            <span class="material-symbols-outlined">close</span>
          </button>
        </header>
        <div class="modal-body">
          <label class="control">
            Token (generated on create)
            <div class="token-create-row">
              <input type="text" id="tokenCreateValue" readonly />
              <button class="btn subtle" id="copyTokenValue" type="button">Copy</button>
            </div>
          </label>
          <label class="control">
            Name
            <input type="text" id="tokenCreateName" />
          </label>
          <div class="config-status" id="tokenCreateStatus"></div>
          <div class="schedule-actions align-right">
            <button class="btn subtle" id="createTokenSubmit">Create</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="createProjectModal">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <header class="modal-header">
          <div>
            <div class="modal-title">Create project</div>
            <div class="modal-subtitle">Provision a new compose project on a host.</div>
          </div>
          <button class="modal-close" id="closeCreateProjectModal" aria-label="Close">
            <span class="material-symbols-outlined">close</span>
          </button>
        </header>
        <div class="modal-body">
          <div class="config-grid">
            <label class="control">
              Host
              <select id="createProjectHost"></select>
            </label>
            <label class="control">
              Project name
              <input type="text" id="createProjectName" placeholder="my-app" />
            </label>
            <label class="toggle" id="createProjectBackupToggle">
              <input type="checkbox" id="createProjectBackup" />
              <span>Enable backup?</span>
            </label>
          </div>
          <div class="create-run">
            <label class="control">
              Docker run command (Optional: paste a docker run command to convert to compose.)
              <input type="text" id="createProjectRun" placeholder="docker run ..." />
            </label>
            <button class="btn subtle" id="convertRunToCompose">Convert</button>
          </div>
          <label class="control span-2 create-compose">
            Compose file
            <div class="compose-editor-wrap">
              <textarea id="createProjectCompose" rows="10" placeholder="version: '3.9'"></textarea>
            </div>
          </label>
          <div class="compose-search hidden" id="createSearchBar">
            <label class="control">
              Find
              <input type="text" id="createSearchInput" autocomplete="off" />
            </label>
            <label class="control">
              Replace
              <input type="text" id="createReplaceInput" autocomplete="off" />
            </label>
            <div class="compose-search-actions">
              <button class="btn subtle" id="createFindNext" type="button">Find</button>
              <button class="btn subtle" id="createReplace" type="button">Replace</button>
              <button class="btn subtle" id="createReplaceAll" type="button">Replace all</button>
              <button class="btn ghost" id="createSearchClose" type="button" aria-label="Close search" title="Close">Close</button>
            </div>
          </div>
          <div class="progress create-progress hidden">
            <div class="progress-text" id="createProjectProgressText">Awaiting input</div>
            <div class="progress-track">
              <div class="progress-bar" id="createProjectProgressBar"></div>
            </div>
          </div>
          <div class="config-status" id="createProjectStatus"></div>
          <div class="schedule-actions align-right">
            <button class="btn primary accent-blue" id="createProjectSubmit">Create</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="deleteProjectModal">
      <div class="modal-backdrop"></div>
      <div class="modal-card confirm-modal-card">
        <header class="modal-header">
          <div>
            <div class="modal-title">Delete project</div>
            <div class="modal-subtitle" id="deleteProjectTarget"></div>
          </div>
          <button class="modal-close" id="closeDeleteProjectModal" aria-label="Close">
            <span class="material-symbols-outlined">close</span>
          </button>
        </header>
        <div class="modal-body confirm-body">
          <div class="confirm-warning">
            This removes the project directory and all files from the host.
          </div>
          <label class="toggle delete-backup-toggle" id="deleteProjectBackupToggle">
            <input type="checkbox" id="deleteProjectBackup" />
            <span>Also delete from backup?</span>
          </label>
          <div class="schedule-actions align-right">
            <button class="btn danger" id="confirmDeleteProject">Delete</button>
          </div>
          <div class="config-status" id="deleteProjectStatus"></div>
        </div>
      </div>
    </div>

    <script src="/static/vendor/xterm/xterm.min.js"></script>
    <script src="/static/vendor/xterm/xterm-addon-fit.min.js"></script>
    <script src="/static/vendor/codemirror/codemirror.min.js"></script>
    <script src="/static/vendor/js-yaml.min.js"></script>
    <script src="/static/vendor/codemirror/addon/lint/lint.min.js"></script>
    <script src="/static/vendor/codemirror/addon/lint/yaml-lint.min.js"></script>
    <script src="/static/vendor/codemirror/mode/yaml/yaml.min.js"></script>
    <script src="/static/vendor/codemirror/addon/merge/diff_match_patch.js"></script>
    <script src="/static/vendor/codemirror/addon/merge/merge.min.js"></script>
    <script src="/static/app.js"></script>
  </body>
</html>
